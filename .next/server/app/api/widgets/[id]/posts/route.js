"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/widgets/[id]/posts/route";
exports.ids = ["app/api/widgets/[id]/posts/route"];
exports.modules = {

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fwidgets%2F%5Bid%5D%2Fposts%2Froute&page=%2Fapi%2Fwidgets%2F%5Bid%5D%2Fposts%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwidgets%2F%5Bid%5D%2Fposts%2Froute.ts&appDir=%2FUsers%2Fcookiemonster%2FDocuments%2FReact-app%2FCuddles-CMS%2FInsta_grid%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcookiemonster%2FDocuments%2FReact-app%2FCuddles-CMS%2FInsta_grid&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fwidgets%2F%5Bid%5D%2Fposts%2Froute&page=%2Fapi%2Fwidgets%2F%5Bid%5D%2Fposts%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwidgets%2F%5Bid%5D%2Fposts%2Froute.ts&appDir=%2FUsers%2Fcookiemonster%2FDocuments%2FReact-app%2FCuddles-CMS%2FInsta_grid%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcookiemonster%2FDocuments%2FReact-app%2FCuddles-CMS%2FInsta_grid&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_cookiemonster_Documents_React_app_Cuddles_CMS_Insta_grid_app_api_widgets_id_posts_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/widgets/[id]/posts/route.ts */ \"(rsc)/./app/api/widgets/[id]/posts/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/widgets/[id]/posts/route\",\n        pathname: \"/api/widgets/[id]/posts\",\n        filename: \"route\",\n        bundlePath: \"app/api/widgets/[id]/posts/route\"\n    },\n    resolvedPagePath: \"/Users/cookiemonster/Documents/React-app/Cuddles-CMS/Insta_grid/app/api/widgets/[id]/posts/route.ts\",\n    nextConfigOutput,\n    userland: _Users_cookiemonster_Documents_React_app_Cuddles_CMS_Insta_grid_app_api_widgets_id_posts_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/widgets/[id]/posts/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ3aWRnZXRzJTJGJTVCaWQlNUQlMkZwb3N0cyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGd2lkZ2V0cyUyRiU1QmlkJTVEJTJGcG9zdHMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZ3aWRnZXRzJTJGJTVCaWQlNUQlMkZwb3N0cyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmNvb2tpZW1vbnN0ZXIlMkZEb2N1bWVudHMlMkZSZWFjdC1hcHAlMkZDdWRkbGVzLUNNUyUyRkluc3RhX2dyaWQlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGY29va2llbW9uc3RlciUyRkRvY3VtZW50cyUyRlJlYWN0LWFwcCUyRkN1ZGRsZXMtQ01TJTJGSW5zdGFfZ3JpZCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDbUQ7QUFDaEk7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9pbnN0YS1ncmlkLz84M2U1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9jb29raWVtb25zdGVyL0RvY3VtZW50cy9SZWFjdC1hcHAvQ3VkZGxlcy1DTVMvSW5zdGFfZ3JpZC9hcHAvYXBpL3dpZGdldHMvW2lkXS9wb3N0cy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvd2lkZ2V0cy9baWRdL3Bvc3RzL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvd2lkZ2V0cy9baWRdL3Bvc3RzXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS93aWRnZXRzL1tpZF0vcG9zdHMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvY29va2llbW9uc3Rlci9Eb2N1bWVudHMvUmVhY3QtYXBwL0N1ZGRsZXMtQ01TL0luc3RhX2dyaWQvYXBwL2FwaS93aWRnZXRzL1tpZF0vcG9zdHMvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3dpZGdldHMvW2lkXS9wb3N0cy9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fwidgets%2F%5Bid%5D%2Fposts%2Froute&page=%2Fapi%2Fwidgets%2F%5Bid%5D%2Fposts%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwidgets%2F%5Bid%5D%2Fposts%2Froute.ts&appDir=%2FUsers%2Fcookiemonster%2FDocuments%2FReact-app%2FCuddles-CMS%2FInsta_grid%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcookiemonster%2FDocuments%2FReact-app%2FCuddles-CMS%2FInsta_grid&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/widgets/[id]/posts/route.ts":
/*!*********************************************!*\
  !*** ./app/api/widgets/[id]/posts/route.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   dynamic: () => (/* binding */ dynamic),\n/* harmony export */   revalidate: () => (/* binding */ revalidate)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/mongodb */ \"(rsc)/./lib/mongodb.ts\");\n/* harmony import */ var _lib_encryption__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/encryption */ \"(rsc)/./lib/encryption.ts\");\n/* harmony import */ var _notionhq_client__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @notionhq/client */ \"(rsc)/./node_modules/@notionhq/client/build/src/index.js\");\n\n\n\n\n// Disable caching for this route\nconst dynamic = \"force-dynamic\";\nconst revalidate = 0;\nfunction getPropertyValue(page, propertyName) {\n    const property = page.properties[propertyName];\n    if (!property) return null;\n    switch(property.type){\n        case \"title\":\n            return property.title.map((t)=>t.plain_text).join(\"\") || \"\";\n        case \"rich_text\":\n            return property.rich_text.map((t)=>t.plain_text).join(\"\") || \"\";\n        case \"select\":\n            return property.select?.name || \"\";\n        case \"multi_select\":\n            // Return array of selected option names\n            return property.multi_select.map((option)=>option.name);\n        case \"status\":\n            return property.status?.name || \"\";\n        case \"number\":\n            return property.number ?? 0;\n        case \"checkbox\":\n            return property.checkbox ?? false;\n        case \"date\":\n            // Return ISO date string, or null if no date set\n            return property.date?.start || null;\n        case \"files\":\n            // Supports both uploaded files and embedded links (external URLs)\n            const urls = [];\n            for (const file of property.files){\n                if (file.type === \"file\") {\n                    urls.push(file.file.url);\n                } else if (file.type === \"external\") {\n                    urls.push(file.external.url);\n                }\n            }\n            return urls;\n        case \"url\":\n            return property.url || \"\";\n        default:\n            return null;\n    }\n}\n// GET /api/widgets/[id]/posts - Fetch posts for a widget\nasync function GET(request, { params }) {\n    try {\n        const db = await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.getDb)();\n        // Find widget by widgetId (the short ID used in embed URLs)\n        const widget = await db.collection(\"widgets\").findOne({\n            widgetId: params.id\n        });\n        if (!widget) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Widget not found\"\n            }, {\n                status: 404\n            });\n        }\n        // Decrypt the Notion token\n        const notionToken = (0,_lib_encryption__WEBPACK_IMPORTED_MODULE_2__.decrypt)(widget.notionToken);\n        const notion = new _notionhq_client__WEBPACK_IMPORTED_MODULE_3__.Client({\n            auth: notionToken\n        });\n        // Query the Notion database\n        // Sort by Date (most recent first) - Date field handles both chronological order and manual reordering\n        let response;\n        try {\n            response = await notion.databases.query({\n                database_id: widget.databaseId,\n                sorts: [\n                    {\n                        property: \"Date\",\n                        direction: \"descending\"\n                    }\n                ]\n            });\n        } catch (dateError) {\n            // If Date property doesn't exist, fall back to Order sorting\n            if (dateError?.code === \"validation_error\" && dateError?.body?.includes(\"Date\")) {\n                response = await notion.databases.query({\n                    database_id: widget.databaseId,\n                    sorts: [\n                        {\n                            property: \"Order\",\n                            direction: \"ascending\"\n                        }\n                    ]\n                });\n            } else {\n                throw dateError;\n            }\n        }\n        const posts = response.results.filter((page)=>\"properties\" in page).map((page, index)=>{\n            const name = getPropertyValue(page, \"Name\");\n            // Content (Files & media): supports uploads and embedded links; fallback to \"Files\" for backward compatibility\n            const images = (getPropertyValue(page, \"Content\") ?? getPropertyValue(page, \"Files\")) || [];\n            const propertyKeys = Object.keys(page.properties);\n            // Read Status directly from property (case-insensitive)\n            // Notion uses type \"status\" (not \"select\") with property.status.name and property.status.color\n            let status = \"\";\n            let statusColor = \"\";\n            const statusKey = propertyKeys.find((key)=>key.toLowerCase() === \"status\");\n            if (statusKey) {\n                const statusProperty = page.properties[statusKey];\n                if (statusProperty?.type === \"status\") {\n                    // Status type: value is at property.status.name and color at property.status.color\n                    status = statusProperty.status?.name || \"\";\n                    statusColor = statusProperty.status?.color || \"\";\n                } else if (statusProperty?.type === \"select\") {\n                    // Fallback for select type\n                    status = statusProperty.select?.name || \"\";\n                } else {\n                    status = getPropertyValue(page, statusKey) || \"\";\n                }\n            } else {\n                status = getPropertyValue(page, \"Status\") || \"\";\n            }\n            const caption = getPropertyValue(page, \"Caption\");\n            const order = getPropertyValue(page, \"Order\") || null; // Optional, only for unpinned posts\n            const date = getPropertyValue(page, \"Date\");\n            const pinnedPlacement = getPropertyValue(page, \"Pinned Placement\") || [];\n            // Check if post has a pinned placement (1, 2, or 3)\n            const pinnedPlacementValue = pinnedPlacement.find((val)=>[\n                    \"1\",\n                    \"2\",\n                    \"3\"\n                ].includes(val));\n            const isPinned = !!pinnedPlacementValue;\n            const pinnedOrder = pinnedPlacementValue ? parseInt(pinnedPlacementValue, 10) : null;\n            // Find platform property by checking all property keys (case-insensitive)\n            let platformRaw = \"\";\n            // Try exact match first (case-insensitive)\n            let platformKey = propertyKeys.find((key)=>key.toLowerCase() === \"platform\");\n            // If not found, try capitalized \"Platform\"\n            if (!platformKey) {\n                platformKey = propertyKeys.find((key)=>key === \"Platform\");\n            }\n            // If still not found, try partial match\n            if (!platformKey) {\n                platformKey = propertyKeys.find((key)=>key.toLowerCase().includes(\"platform\"));\n            }\n            if (platformKey) {\n                const platformProperty = page.properties[platformKey];\n                // Handle select type directly\n                if (platformProperty.type === \"select\") {\n                    platformRaw = platformProperty.select?.name || \"\";\n                } else {\n                    platformRaw = getPropertyValue(page, platformKey) || \"\";\n                }\n            }\n            const platformLower = platformRaw.trim().toLowerCase();\n            const platform = platformLower.includes(\"tiktok\") ? \"tiktok\" : \"instagram\";\n            // Find source property (case-insensitive) - can be URL or text type\n            let source = \"\";\n            let sourceKey = propertyKeys.find((key)=>key === \"Source\");\n            // If not found, try lowercase\n            if (!sourceKey) {\n                sourceKey = propertyKeys.find((key)=>key.toLowerCase() === \"source\");\n            }\n            if (sourceKey) {\n                const sourceProperty = page.properties[sourceKey];\n                if (sourceProperty) {\n                    // Handle URL type directly\n                    if (sourceProperty.type === \"url\") {\n                        source = sourceProperty.url || \"\";\n                    } else {\n                        // Handle text/rich_text types\n                        const sourceValue = getPropertyValue(page, sourceKey);\n                        if (sourceValue && typeof sourceValue === \"string\") {\n                            source = sourceValue.trim();\n                        }\n                    }\n                }\n            }\n            return {\n                id: page.id,\n                name: name || \"Untitled\",\n                images,\n                status: status || \"planned\",\n                statusColor: statusColor || undefined,\n                caption: caption || \"\",\n                order: order || index + 1,\n                pinned: isPinned,\n                platform,\n                source: source && source.trim() ? source.trim() : undefined,\n                date: date || undefined,\n                pinnedPlacement: pinnedOrder || undefined\n            };\n        });\n        // Validate pinned posts: only allow maximum 3 pinned posts with unique placements (1, 2, 3)\n        // If more than 3 posts have Pinned Placement values, or if there are duplicates, fix them\n        const pinnedPostsList = posts.filter((p)=>p.pinnedPlacement !== undefined && p.pinnedPlacement >= 1 && p.pinnedPlacement <= 3);\n        // Check for duplicates - each placement (1, 2, 3) should only be used once\n        const placementCounts = {\n            1: 0,\n            2: 0,\n            3: 0\n        };\n        pinnedPostsList.forEach((p)=>{\n            if (p.pinnedPlacement) {\n                placementCounts[p.pinnedPlacement] = (placementCounts[p.pinnedPlacement] || 0) + 1;\n            }\n        });\n        // If there are more than 3 pinned posts OR duplicates, fix it\n        if (pinnedPostsList.length > 3 || Object.values(placementCounts).some((count)=>count > 1)) {\n            console.warn(`Warning: Invalid Pinned Placement configuration detected. Fixing...`);\n            // Sort by Pinned Placement, then by date to determine priority\n            pinnedPostsList.sort((a, b)=>{\n                const placementDiff = (a.pinnedPlacement || 999) - (b.pinnedPlacement || 999);\n                if (placementDiff !== 0) return placementDiff;\n                // If same placement, prefer more recent date\n                if (a.date && b.date) {\n                    return new Date(b.date).getTime() - new Date(a.date).getTime();\n                }\n                return 0;\n            });\n            // Keep only the first post for each placement (1, 2, 3)\n            const keptPlacements = new Set();\n            const postsToUnpin = [];\n            for (const post of pinnedPostsList){\n                if (post.pinnedPlacement && !keptPlacements.has(post.pinnedPlacement)) {\n                    keptPlacements.add(post.pinnedPlacement);\n                } else {\n                    postsToUnpin.push(post);\n                }\n            }\n            // Clear Pinned Placement for duplicates and extras\n            for (const postToUnpin of postsToUnpin){\n                try {\n                    await notion.pages.update({\n                        page_id: postToUnpin.id,\n                        properties: {\n                            \"Pinned Placement\": {\n                                multi_select: []\n                            }\n                        }\n                    });\n                    // Update local post to reflect unpinned state\n                    const postIndex = posts.findIndex((p)=>p.id === postToUnpin.id);\n                    if (postIndex !== -1) {\n                        posts[postIndex].pinned = false;\n                        posts[postIndex].pinnedPlacement = undefined;\n                    }\n                } catch (error) {\n                    console.warn(`Failed to clear Pinned Placement for post ${postToUnpin.id}:`, error);\n                }\n            }\n        }\n        // Sort: pinned posts first by Pinned Placement (1, 2, 3), then unpinned posts by Date\n        posts.sort((a, b)=>{\n            const aPinnedPlacement = a.pinnedPlacement;\n            const bPinnedPlacement = b.pinnedPlacement;\n            const aIsPinned = a.pinned || aPinnedPlacement !== undefined && aPinnedPlacement >= 1 && aPinnedPlacement <= 3;\n            const bIsPinned = b.pinned || bPinnedPlacement !== undefined && bPinnedPlacement >= 1 && bPinnedPlacement <= 3;\n            // Pinned posts come first\n            if (aIsPinned && !bIsPinned) return -1;\n            if (!aIsPinned && bIsPinned) return 1;\n            // If both are pinned, sort by Pinned Placement (1, 2, 3)\n            if (aIsPinned && bIsPinned) {\n                const aPlacement = aPinnedPlacement || 999;\n                const bPlacement = bPinnedPlacement || 999;\n                return aPlacement - bPlacement;\n            }\n            // If both are unpinned, sort by Date (most recent first)\n            if (a.date && b.date) {\n                const dateA = new Date(a.date).getTime();\n                const dateB = new Date(b.date).getTime();\n                return dateB - dateA; // Descending (most recent first)\n            }\n            // If only one has a date, prioritize it\n            if (a.date && !b.date) return -1;\n            if (!a.date && b.date) return 1;\n            // Fallback to order\n            return a.order - b.order;\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(posts, {\n            headers: {\n                \"Cache-Control\": \"no-store, no-cache, must-revalidate, proxy-revalidate\",\n                \"Pragma\": \"no-cache\",\n                \"Expires\": \"0\"\n            }\n        });\n    } catch (error) {\n        console.error(\"Error fetching posts:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to fetch posts from Notion\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3dpZGdldHMvW2lkXS9wb3N0cy9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQXdEO0FBQ2xCO0FBQ0s7QUFDRDtBQUcxQyxpQ0FBaUM7QUFDMUIsTUFBTUksVUFBVSxnQkFBZ0I7QUFDaEMsTUFBTUMsYUFBYSxFQUFFO0FBbUI1QixTQUFTQyxpQkFDUEMsSUFBd0IsRUFDeEJDLFlBQW9CO0lBRXBCLE1BQU1DLFdBQVdGLEtBQUtHLFVBQVUsQ0FBQ0YsYUFBYTtJQUM5QyxJQUFJLENBQUNDLFVBQVUsT0FBTztJQUV0QixPQUFRQSxTQUFTRSxJQUFJO1FBQ25CLEtBQUs7WUFDSCxPQUFPRixTQUFTRyxLQUFLLENBQUNDLEdBQUcsQ0FBQyxDQUFDQyxJQUFNQSxFQUFFQyxVQUFVLEVBQUVDLElBQUksQ0FBQyxPQUFPO1FBQzdELEtBQUs7WUFDSCxPQUFPUCxTQUFTUSxTQUFTLENBQUNKLEdBQUcsQ0FBQyxDQUFDQyxJQUFNQSxFQUFFQyxVQUFVLEVBQUVDLElBQUksQ0FBQyxPQUFPO1FBQ2pFLEtBQUs7WUFDSCxPQUFPUCxTQUFTUyxNQUFNLEVBQUVDLFFBQVE7UUFDbEMsS0FBSztZQUNILHdDQUF3QztZQUN4QyxPQUFPVixTQUFTVyxZQUFZLENBQUNQLEdBQUcsQ0FBQyxDQUFDUSxTQUFXQSxPQUFPRixJQUFJO1FBQzFELEtBQUs7WUFDSCxPQUFPVixTQUFTYSxNQUFNLEVBQUVILFFBQVE7UUFDbEMsS0FBSztZQUNILE9BQU9WLFNBQVNjLE1BQU0sSUFBSTtRQUM1QixLQUFLO1lBQ0gsT0FBT2QsU0FBU2UsUUFBUSxJQUFJO1FBQzlCLEtBQUs7WUFDSCxpREFBaUQ7WUFDakQsT0FBT2YsU0FBU2dCLElBQUksRUFBRUMsU0FBUztRQUNqQyxLQUFLO1lBQ0gsa0VBQWtFO1lBQ2xFLE1BQU1DLE9BQWlCLEVBQUU7WUFDekIsS0FBSyxNQUFNQyxRQUFRbkIsU0FBU29CLEtBQUssQ0FBRTtnQkFDakMsSUFBSUQsS0FBS2pCLElB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Iiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaW5zdGEtZ3JpZC8uL2FwcC9hcGkvd2lkZ2V0cy9baWRdL3Bvc3RzL3JvdXRlLnRzPzlkMWUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHsgZ2V0RGIgfSBmcm9tIFwiQC9saWIvbW9uZ29kYlwiO1xuaW1wb3J0IHsgZGVjcnlwdCB9IGZyb20gXCJAL2xpYi9lbmNyeXB0aW9uXCI7XG5pbXBvcnQgeyBDbGllbnQgfSBmcm9tIFwiQG5vdGlvbmhxL2NsaWVudFwiO1xuaW1wb3J0IHsgUGFnZU9iamVjdFJlc3BvbnNlLCBRdWVyeURhdGFiYXNlUmVzcG9uc2UgfSBmcm9tIFwiQG5vdGlvbmhxL2NsaWVudC9idWlsZC9zcmMvYXBpLWVuZHBvaW50c1wiO1xuXG4vLyBEaXNhYmxlIGNhY2hpbmcgZm9yIHRoaXMgcm91dGVcbmV4cG9ydCBjb25zdCBkeW5hbWljID0gXCJmb3JjZS1keW5hbWljXCI7XG5leHBvcnQgY29uc3QgcmV2YWxpZGF0ZSA9IDA7XG5cbnR5cGUgUGxhdGZvcm0gPSBcImluc3RhZ3JhbVwiIHwgXCJ0aWt0b2tcIjtcblxuaW50ZXJmYWNlIE5vdGlvblBvc3Qge1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIGltYWdlczogc3RyaW5nW107XG4gIHN0YXR1czogc3RyaW5nO1xuICBzdGF0dXNDb2xvcj86IHN0cmluZztcbiAgY2FwdGlvbjogc3RyaW5nO1xuICBvcmRlcjogbnVtYmVyO1xuICBwaW5uZWQ6IGJvb2xlYW47XG4gIHBsYXRmb3JtOiBQbGF0Zm9ybTtcbiAgc291cmNlPzogc3RyaW5nO1xuICBkYXRlPzogc3RyaW5nOyAvLyBJU08gZGF0ZSBzdHJpbmcgZm9yIGNocm9ub2xvZ2ljYWwgc29ydGluZ1xuICBwaW5uZWRQbGFjZW1lbnQ/OiBudW1iZXI7IC8vIFBpbm5lZCBwbGFjZW1lbnQgdmFsdWU6IDEsIDIsIG9yIDMgKGZyb20gXCJQaW5uZWQgUGxhY2VtZW50XCIgbXVsdGktc2VsZWN0KVxufVxuXG5mdW5jdGlvbiBnZXRQcm9wZXJ0eVZhbHVlKFxuICBwYWdlOiBQYWdlT2JqZWN0UmVzcG9uc2UsXG4gIHByb3BlcnR5TmFtZTogc3RyaW5nXG4pOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgc3RyaW5nW10gfCBudWxsIHtcbiAgY29uc3QgcHJvcGVydHkgPSBwYWdlLnByb3BlcnRpZXNbcHJvcGVydHlOYW1lXTtcbiAgaWYgKCFwcm9wZXJ0eSkgcmV0dXJuIG51bGw7XG5cbiAgc3dpdGNoIChwcm9wZXJ0eS50eXBlKSB7XG4gICAgY2FzZSBcInRpdGxlXCI6XG4gICAgICByZXR1cm4gcHJvcGVydHkudGl0bGUubWFwKCh0KSA9PiB0LnBsYWluX3RleHQpLmpvaW4oXCJcIikgfHwgXCJcIjtcbiAgICBjYXNlIFwicmljaF90ZXh0XCI6XG4gICAgICByZXR1cm4gcHJvcGVydHkucmljaF90ZXh0Lm1hcCgodCkgPT4gdC5wbGFpbl90ZXh0KS5qb2luKFwiXCIpIHx8IFwiXCI7XG4gICAgY2FzZSBcInNlbGVjdFwiOlxuICAgICAgcmV0dXJuIHByb3BlcnR5LnNlbGVjdD8ubmFtZSB8fCBcIlwiO1xuICAgIGNhc2UgXCJtdWx0aV9zZWxlY3RcIjpcbiAgICAgIC8vIFJldHVybiBhcnJheSBvZiBzZWxlY3RlZCBvcHRpb24gbmFtZXNcbiAgICAgIHJldHVybiBwcm9wZXJ0eS5tdWx0aV9zZWxlY3QubWFwKChvcHRpb24pID0+IG9wdGlvbi5uYW1lKTtcbiAgICBjYXNlIFwic3RhdHVzXCI6XG4gICAgICByZXR1cm4gcHJvcGVydHkuc3RhdHVzPy5uYW1lIHx8IFwiXCI7XG4gICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgcmV0dXJuIHByb3BlcnR5Lm51bWJlciA/PyAwO1xuICAgIGNhc2UgXCJjaGVja2JveFwiOlxuICAgICAgcmV0dXJuIHByb3BlcnR5LmNoZWNrYm94ID8/IGZhbHNlO1xuICAgIGNhc2UgXCJkYXRlXCI6XG4gICAgICAvLyBSZXR1cm4gSVNPIGRhdGUgc3RyaW5nLCBvciBudWxsIGlmIG5vIGRhdGUgc2V0XG4gICAgICByZXR1cm4gcHJvcGVydHkuZGF0ZT8uc3RhcnQgfHwgbnVsbDtcbiAgICBjYXNlIFwiZmlsZXNcIjpcbiAgICAgIC8vIFN1cHBvcnRzIGJvdGggdXBsb2FkZWQgZmlsZXMgYW5kIGVtYmVkZGVkIGxpbmtzIChleHRlcm5hbCBVUkxzKVxuICAgICAgY29uc3QgdXJsczogc3RyaW5nW10gPSBbXTtcbiAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBwcm9wZXJ0eS5maWxlcykge1xuICAgICAgICBpZiAoZmlsZS50eXBlID09PSBcImZpbGVcIikge1xuICAgICAgICAgIHVybHMucHVzaChmaWxlLmZpbGUudXJsKTtcbiAgICAgICAgfSBlbHNlIGlmIChmaWxlLnR5cGUgPT09IFwiZXh0ZXJuYWxcIikge1xuICAgICAgICAgIHVybHMucHVzaChmaWxlLmV4dGVybmFsLnVybCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB1cmxzO1xuICAgIGNhc2UgXCJ1cmxcIjpcbiAgICAgIHJldHVybiBwcm9wZXJ0eS51cmwgfHwgXCJcIjtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLy8gR0VUIC9hcGkvd2lkZ2V0cy9baWRdL3Bvc3RzIC0gRmV0Y2ggcG9zdHMgZm9yIGEgd2lkZ2V0XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKFxuICByZXF1ZXN0OiBOZXh0UmVxdWVzdCxcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgaWQ6IHN0cmluZyB9IH1cbikge1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGIoKTtcblxuICAgIC8vIEZpbmQgd2lkZ2V0IGJ5IHdpZGdldElkICh0aGUgc2hvcnQgSUQgdXNlZCBpbiBlbWJlZCBVUkxzKVxuICAgIGNvbnN0IHdpZGdldCA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oXCJ3aWRnZXRzXCIpLmZpbmRPbmUoe1xuICAgICAgd2lkZ2V0SWQ6IHBhcmFtcy5pZCxcbiAgICB9KTtcblxuICAgIGlmICghd2lkZ2V0KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJXaWRnZXQgbm90IGZvdW5kXCIgfSwgeyBzdGF0dXM6IDQwNCB9KTtcbiAgICB9XG5cbiAgICAvLyBEZWNyeXB0IHRoZSBOb3Rpb24gdG9rZW5cbiAgICBjb25zdCBub3Rpb25Ub2tlbiA9IGRlY3J5cHQod2lkZ2V0Lm5vdGlvblRva2VuKTtcbiAgICBjb25zdCBub3Rpb24gPSBuZXcgQ2xpZW50KHsgYXV0aDogbm90aW9uVG9rZW4gfSk7XG5cbiAgICAvLyBRdWVyeSB0aGUgTm90aW9uIGRhdGFiYXNlXG4gICAgLy8gU29ydCBieSBEYXRlIChtb3N0IHJlY2VudCBmaXJzdCkgLSBEYXRlIGZpZWxkIGhhbmRsZXMgYm90aCBjaHJvbm9sb2dpY2FsIG9yZGVyIGFuZCBtYW51YWwgcmVvcmRlcmluZ1xuICAgIGxldCByZXNwb25zZTogUXVlcnlEYXRhYmFzZVJlc3BvbnNlO1xuICAgIHRyeSB7XG4gICAgICByZXNwb25zZSA9IGF3YWl0IG5vdGlvbi5kYXRhYmFzZXMucXVlcnkoe1xuICAgICAgICBkYXRhYmFzZV9pZDogd2lkZ2V0LmRhdGFiYXNlSWQsXG4gICAgICAgIHNvcnRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgcHJvcGVydHk6IFwiRGF0ZVwiLFxuICAgICAgICAgICAgZGlyZWN0aW9uOiBcImRlc2NlbmRpbmdcIixcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZGF0ZUVycm9yOiBhbnkpIHtcbiAgICAgIC8vIElmIERhdGUgcHJvcGVydHkgZG9lc24ndCBleGlzdCwgZmFsbCBiYWNrIHRvIE9yZGVyIHNvcnRpbmdcbiAgICAgIGlmIChkYXRlRXJyb3I/LmNvZGUgPT09ICd2YWxpZGF0aW9uX2Vycm9yJyAmJiBkYXRlRXJyb3I/LmJvZHk/LmluY2x1ZGVzKCdEYXRlJykpIHtcbiAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCBub3Rpb24uZGF0YWJhc2VzLnF1ZXJ5KHtcbiAgICAgICAgICBkYXRhYmFzZV9pZDogd2lkZ2V0LmRhdGFiYXNlSWQsXG4gICAgICAgICAgc29ydHM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgcHJvcGVydHk6IFwiT3JkZXJcIixcbiAgICAgICAgICAgICAgZGlyZWN0aW9uOiBcImFzY2VuZGluZ1wiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IGRhdGVFcnJvcjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBwb3N0czogTm90aW9uUG9zdFtdID0gcmVzcG9uc2UucmVzdWx0c1xuICAgICAgLmZpbHRlcigocGFnZSk6IHBhZ2UgaXMgUGFnZU9iamVjdFJlc3BvbnNlID0+IFwicHJvcGVydGllc1wiIGluIHBhZ2UpXG4gICAgICAubWFwKChwYWdlLCBpbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBuYW1lID0gZ2V0UHJvcGVydHlWYWx1ZShwYWdlLCBcIk5hbWVcIikgYXMgc3RyaW5nO1xuICAgICAgICAvLyBDb250ZW50IChGaWxlcyAmIG1lZGlhKTogc3VwcG9ydHMgdXBsb2FkcyBhbmQgZW1iZWRkZWQgbGlua3M7IGZhbGxiYWNrIHRvIFwiRmlsZXNcIiBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICAgICAgICBjb25zdCBpbWFnZXMgPSAoKGdldFByb3BlcnR5VmFsdWUocGFnZSwgXCJDb250ZW50XCIpID8/IGdldFByb3BlcnR5VmFsdWUocGFnZSwgXCJGaWxlc1wiKSkgYXMgc3RyaW5nW10pIHx8IFtdO1xuICAgICAgICBjb25zdCBwcm9wZXJ0eUtleXMgPSBPYmplY3Qua2V5cyhwYWdlLnByb3BlcnRpZXMpO1xuICAgICAgICBcbiAgICAgICAgLy8gUmVhZCBTdGF0dXMgZGlyZWN0bHkgZnJvbSBwcm9wZXJ0eSAoY2FzZS1pbnNlbnNpdGl2ZSlcbiAgICAgICAgLy8gTm90aW9uIHVzZXMgdHlwZSBcInN0YXR1c1wiIChub3QgXCJzZWxlY3RcIikgd2l0aCBwcm9wZXJ0eS5zdGF0dXMubmFtZSBhbmQgcHJvcGVydHkuc3RhdHVzLmNvbG9yXG4gICAgICAgIGxldCBzdGF0dXMgPSBcIlwiO1xuICAgICAgICBsZXQgc3RhdHVzQ29sb3IgPSBcIlwiO1xuICAgICAgICBjb25zdCBzdGF0dXNLZXkgPSBwcm9wZXJ0eUtleXMuZmluZChcbiAgICAgICAgICAoa2V5KSA9PiBrZXkudG9Mb3dlckNhc2UoKSA9PT0gXCJzdGF0dXNcIlxuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgaWYgKHN0YXR1c0tleSkge1xuICAgICAgICAgIGNvbnN0IHN0YXR1c1Byb3BlcnR5ID0gcGFnZS5wcm9wZXJ0aWVzW3N0YXR1c0tleV07XG4gICAgICAgICAgaWYgKHN0YXR1c1Byb3BlcnR5Py50eXBlID09PSBcInN0YXR1c1wiKSB7XG4gICAgICAgICAgICAvLyBTdGF0dXMgdHlwZTogdmFsdWUgaXMgYXQgcHJvcGVydHkuc3RhdHVzLm5hbWUgYW5kIGNvbG9yIGF0IHByb3BlcnR5LnN0YXR1cy5jb2xvclxuICAgICAgICAgICAgc3RhdHVzID0gc3RhdHVzUHJvcGVydHkuc3RhdHVzPy5uYW1lIHx8IFwiXCI7XG4gICAgICAgICAgICBzdGF0dXNDb2xvciA9IHN0YXR1c1Byb3BlcnR5LnN0YXR1cz8uY29sb3IgfHwgXCJcIjtcbiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1c1Byb3BlcnR5Py50eXBlID09PSBcInNlbGVjdFwiKSB7XG4gICAgICAgICAgICAvLyBGYWxsYmFjayBmb3Igc2VsZWN0IHR5cGVcbiAgICAgICAgICAgIHN0YXR1cyA9IHN0YXR1c1Byb3BlcnR5LnNlbGVjdD8ubmFtZSB8fCBcIlwiO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdGF0dXMgPSAoZ2V0UHJvcGVydHlWYWx1ZShwYWdlLCBzdGF0dXNLZXkpIGFzIHN0cmluZykgfHwgXCJcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3RhdHVzID0gKGdldFByb3BlcnR5VmFsdWUocGFnZSwgXCJTdGF0dXNcIikgYXMgc3RyaW5nKSB8fCBcIlwiO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBjYXB0aW9uID0gZ2V0UHJvcGVydHlWYWx1ZShwYWdlLCBcIkNhcHRpb25cIikgYXMgc3RyaW5nO1xuICAgICAgICBjb25zdCBvcmRlciA9IChnZXRQcm9wZXJ0eVZhbHVlKHBhZ2UsIFwiT3JkZXJcIikgYXMgbnVtYmVyKSB8fCBudWxsOyAvLyBPcHRpb25hbCwgb25seSBmb3IgdW5waW5uZWQgcG9zdHNcbiAgICAgICAgY29uc3QgZGF0ZSA9IGdldFByb3BlcnR5VmFsdWUocGFnZSwgXCJEYXRlXCIpIGFzIHN0cmluZyB8IG51bGw7XG4gICAgICAgIGNvbnN0IHBpbm5lZFBsYWNlbWVudCA9IChnZXRQcm9wZXJ0eVZhbHVlKHBhZ2UsIFwiUGlubmVkIFBsYWNlbWVudFwiKSBhcyBzdHJpbmdbXSkgfHwgW107XG4gICAgICAgIFxuICAgICAgICAvLyBDaGVjayBpZiBwb3N0IGhhcyBhIHBpbm5lZCBwbGFjZW1lbnQgKDEsIDIsIG9yIDMpXG4gICAgICAgIGNvbnN0IHBpbm5lZFBsYWNlbWVudFZhbHVlID0gcGlubmVkUGxhY2VtZW50LmZpbmQoKHZhbCkgPT4gW1wiMVwiLCBcIjJcIiwgXCIzXCJdLmluY2x1ZGVzKHZhbCkpO1xuICAgICAgICBjb25zdCBpc1Bpbm5lZCA9ICEhcGlubmVkUGxhY2VtZW50VmFsdWU7XG4gICAgICAgIGNvbnN0IHBpbm5lZE9yZGVyID0gcGlubmVkUGxhY2VtZW50VmFsdWUgPyBwYXJzZUludChwaW5uZWRQbGFjZW1lbnRWYWx1ZSwgMTApIDogbnVsbDtcbiAgICAgICAgXG4gICAgICAgIC8vIEZpbmQgcGxhdGZvcm0gcHJvcGVydHkgYnkgY2hlY2tpbmcgYWxsIHByb3BlcnR5IGtleXMgKGNhc2UtaW5zZW5zaXRpdmUpXG4gICAgICAgIGxldCBwbGF0Zm9ybVJhdyA9IFwiXCI7XG4gICAgICAgIFxuICAgICAgICAvLyBUcnkgZXhhY3QgbWF0Y2ggZmlyc3QgKGNhc2UtaW5zZW5zaXRpdmUpXG4gICAgICAgIGxldCBwbGF0Zm9ybUtleSA9IHByb3BlcnR5S2V5cy5maW5kKFxuICAgICAgICAgIChrZXkpID0+IGtleS50b0xvd2VyQ2FzZSgpID09PSBcInBsYXRmb3JtXCJcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIC8vIElmIG5vdCBmb3VuZCwgdHJ5IGNhcGl0YWxpemVkIFwiUGxhdGZvcm1cIlxuICAgICAgICBpZiAoIXBsYXRmb3JtS2V5KSB7XG4gICAgICAgICAgcGxhdGZvcm1LZXkgPSBwcm9wZXJ0eUtleXMuZmluZChcbiAgICAgICAgICAgIChrZXkpID0+IGtleSA9PT0gXCJQbGF0Zm9ybVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gSWYgc3RpbGwgbm90IGZvdW5kLCB0cnkgcGFydGlhbCBtYXRjaFxuICAgICAgICBpZiAoIXBsYXRmb3JtS2V5KSB7XG4gICAgICAgICAgcGxhdGZvcm1LZXkgPSBwcm9wZXJ0eUtleXMuZmluZChcbiAgICAgICAgICAgIChrZXkpID0+IGtleS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwicGxhdGZvcm1cIilcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAocGxhdGZvcm1LZXkpIHtcbiAgICAgICAgICBjb25zdCBwbGF0Zm9ybVByb3BlcnR5ID0gcGFnZS5wcm9wZXJ0aWVzW3BsYXRmb3JtS2V5XTtcbiAgICAgICAgICAvLyBIYW5kbGUgc2VsZWN0IHR5cGUgZGlyZWN0bHlcbiAgICAgICAgICBpZiAocGxhdGZvcm1Qcm9wZXJ0eS50eXBlID09PSBcInNlbGVjdFwiKSB7XG4gICAgICAgICAgICBwbGF0Zm9ybVJhdyA9IHBsYXRmb3JtUHJvcGVydHkuc2VsZWN0Py5uYW1lIHx8IFwiXCI7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBsYXRmb3JtUmF3ID0gKGdldFByb3BlcnR5VmFsdWUocGFnZSwgcGxhdGZvcm1LZXkpIGFzIHN0cmluZykgfHwgXCJcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHBsYXRmb3JtTG93ZXIgPSBwbGF0Zm9ybVJhdy50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgcGxhdGZvcm06IFBsYXRmb3JtID0gcGxhdGZvcm1Mb3dlci5pbmNsdWRlcyhcInRpa3Rva1wiKSA/IFwidGlrdG9rXCIgOiBcImluc3RhZ3JhbVwiO1xuICAgICAgICBcbiAgICAgICAgLy8gRmluZCBzb3VyY2UgcHJvcGVydHkgKGNhc2UtaW5zZW5zaXRpdmUpIC0gY2FuIGJlIFVSTCBvciB0ZXh0IHR5cGVcbiAgICAgICAgbGV0IHNvdXJjZSA9IFwiXCI7XG4gICAgICAgIGxldCBzb3VyY2VLZXk6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHByb3BlcnR5S2V5cy5maW5kKFxuICAgICAgICAgIChrZXkpID0+IGtleSA9PT0gXCJTb3VyY2VcIlxuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgLy8gSWYgbm90IGZvdW5kLCB0cnkgbG93ZXJjYXNlXG4gICAgICAgIGlmICghc291cmNlS2V5KSB7XG4gICAgICAgICAgc291cmNlS2V5ID0gcHJvcGVydHlLZXlzLmZpbmQoXG4gICAgICAgICAgICAoa2V5KSA9PiBrZXkudG9Mb3dlckNhc2UoKSA9PT0gXCJzb3VyY2VcIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChzb3VyY2VLZXkpIHtcbiAgICAgICAgICBjb25zdCBzb3VyY2VQcm9wZXJ0eSA9IHBhZ2UucHJvcGVydGllc1tzb3VyY2VLZXldO1xuICAgICAgICAgIGlmIChzb3VyY2VQcm9wZXJ0eSkge1xuICAgICAgICAgICAgLy8gSGFuZGxlIFVSTCB0eXBlIGRpcmVjdGx5XG4gICAgICAgICAgICBpZiAoc291cmNlUHJvcGVydHkudHlwZSA9PT0gXCJ1cmxcIikge1xuICAgICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2VQcm9wZXJ0eS51cmwgfHwgXCJcIjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIEhhbmRsZSB0ZXh0L3JpY2hfdGV4dCB0eXBlc1xuICAgICAgICAgICAgICBjb25zdCBzb3VyY2VWYWx1ZSA9IGdldFByb3BlcnR5VmFsdWUocGFnZSwgc291cmNlS2V5KTtcbiAgICAgICAgICAgICAgaWYgKHNvdXJjZVZhbHVlICYmIHR5cGVvZiBzb3VyY2VWYWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIHNvdXJjZSA9IHNvdXJjZVZhbHVlLnRyaW0oKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaWQ6IHBhZ2UuaWQsXG4gICAgICAgICAgbmFtZTogbmFtZSB8fCBcIlVudGl0bGVkXCIsXG4gICAgICAgICAgaW1hZ2VzLFxuICAgICAgICAgIHN0YXR1czogc3RhdHVzIHx8IFwicGxhbm5lZFwiLFxuICAgICAgICAgIHN0YXR1c0NvbG9yOiBzdGF0dXNDb2xvciB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgY2FwdGlvbjogY2FwdGlvbiB8fCBcIlwiLFxuICAgICAgICAgIG9yZGVyOiBvcmRlciB8fCBpbmRleCArIDEsIC8vIEZhbGxiYWNrIHRvIGluZGV4IGlmIE9yZGVyIG5vdCBzZXRcbiAgICAgICAgICBwaW5uZWQ6IGlzUGlubmVkLFxuICAgICAgICAgIHBsYXRmb3JtLFxuICAgICAgICAgIHNvdXJjZTogc291cmNlICYmIHNvdXJjZS50cmltKCkgPyBzb3VyY2UudHJpbSgpIDogdW5kZWZpbmVkLFxuICAgICAgICAgIGRhdGU6IGRhdGUgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgIHBpbm5lZFBsYWNlbWVudDogcGlubmVkT3JkZXIgfHwgdW5kZWZpbmVkLFxuICAgICAgICB9O1xuICAgICAgfSk7XG5cbiAgICAvLyBWYWxpZGF0ZSBwaW5uZWQgcG9zdHM6IG9ubHkgYWxsb3cgbWF4aW11bSAzIHBpbm5lZCBwb3N0cyB3aXRoIHVuaXF1ZSBwbGFjZW1lbnRzICgxLCAyLCAzKVxuICAgIC8vIElmIG1vcmUgdGhhbiAzIHBvc3RzIGhhdmUgUGlubmVkIFBsYWNlbWVudCB2YWx1ZXMsIG9yIGlmIHRoZXJlIGFyZSBkdXBsaWNhdGVzLCBmaXggdGhlbVxuICAgIGNvbnN0IHBpbm5lZFBvc3RzTGlzdCA9IHBvc3RzLmZpbHRlcigocCkgPT4gcC5waW5uZWRQbGFjZW1lbnQgIT09IHVuZGVmaW5lZCAmJiBwLnBpbm5lZFBsYWNlbWVudCA+PSAxICYmIHAucGlubmVkUGxhY2VtZW50IDw9IDMpO1xuICAgIFxuICAgIC8vIENoZWNrIGZvciBkdXBsaWNhdGVzIC0gZWFjaCBwbGFjZW1lbnQgKDEsIDIsIDMpIHNob3VsZCBvbmx5IGJlIHVzZWQgb25jZVxuICAgIGNvbnN0IHBsYWNlbWVudENvdW50czogUmVjb3JkPG51bWJlciwgbnVtYmVyPiA9IHsgMTogMCwgMjogMCwgMzogMCB9O1xuICAgIHBpbm5lZFBvc3RzTGlzdC5mb3JFYWNoKChwKSA9PiB7XG4gICAgICBpZiAocC5waW5uZWRQbGFjZW1lbnQpIHtcbiAgICAgICAgcGxhY2VtZW50Q291bnRzW3AucGlubmVkUGxhY2VtZW50XSA9IChwbGFjZW1lbnRDb3VudHNbcC5waW5uZWRQbGFjZW1lbnRdIHx8IDApICsgMTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICAvLyBJZiB0aGVyZSBhcmUgbW9yZSB0aGFuIDMgcGlubmVkIHBvc3RzIE9SIGR1cGxpY2F0ZXMsIGZpeCBpdFxuICAgIGlmIChwaW5uZWRQb3N0c0xpc3QubGVuZ3RoID4gMyB8fCBPYmplY3QudmFsdWVzKHBsYWNlbWVudENvdW50cykuc29tZSgoY291bnQpID0+IGNvdW50ID4gMSkpIHtcbiAgICAgIGNvbnNvbGUud2FybihgV2FybmluZzogSW52YWxpZCBQaW5uZWQgUGxhY2VtZW50IGNvbmZpZ3VyYXRpb24gZGV0ZWN0ZWQuIEZpeGluZy4uLmApO1xuICAgICAgXG4gICAgICAvLyBTb3J0IGJ5IFBpbm5lZCBQbGFjZW1lbnQsIHRoZW4gYnkgZGF0ZSB0byBkZXRlcm1pbmUgcHJpb3JpdHlcbiAgICAgIHBpbm5lZFBvc3RzTGlzdC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgIGNvbnN0IHBsYWNlbWVudERpZmYgPSAoYS5waW5uZWRQbGFjZW1lbnQgfHwgOTk5KSAtIChiLnBpbm5lZFBsYWNlbWVudCB8fCA5OTkpO1xuICAgICAgICBpZiAocGxhY2VtZW50RGlmZiAhPT0gMCkgcmV0dXJuIHBsYWNlbWVudERpZmY7XG4gICAgICAgIC8vIElmIHNhbWUgcGxhY2VtZW50LCBwcmVmZXIgbW9yZSByZWNlbnQgZGF0ZVxuICAgICAgICBpZiAoYS5kYXRlICYmIGIuZGF0ZSkge1xuICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShiLmRhdGUpLmdldFRpbWUoKSAtIG5ldyBEYXRlKGEuZGF0ZSkuZ2V0VGltZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIEtlZXAgb25seSB0aGUgZmlyc3QgcG9zdCBmb3IgZWFjaCBwbGFjZW1lbnQgKDEsIDIsIDMpXG4gICAgICBjb25zdCBrZXB0UGxhY2VtZW50cyA9IG5ldyBTZXQ8bnVtYmVyPigpO1xuICAgICAgY29uc3QgcG9zdHNUb1VucGluOiB0eXBlb2YgcGlubmVkUG9zdHNMaXN0ID0gW107XG4gICAgICBcbiAgICAgIGZvciAoY29uc3QgcG9zdCBvZiBwaW5uZWRQb3N0c0xpc3QpIHtcbiAgICAgICAgaWYgKHBvc3QucGlubmVkUGxhY2VtZW50ICYmICFrZXB0UGxhY2VtZW50cy5oYXMocG9zdC5waW5uZWRQbGFjZW1lbnQpKSB7XG4gICAgICAgICAga2VwdFBsYWNlbWVudHMuYWRkKHBvc3QucGlubmVkUGxhY2VtZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwb3N0c1RvVW5waW4ucHVzaChwb3N0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDbGVhciBQaW5uZWQgUGxhY2VtZW50IGZvciBkdXBsaWNhdGVzIGFuZCBleHRyYXNcbiAgICAgIGZvciAoY29uc3QgcG9zdFRvVW5waW4gb2YgcG9zdHNUb1VucGluKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgbm90aW9uLnBhZ2VzLnVwZGF0ZSh7XG4gICAgICAgICAgICBwYWdlX2lkOiBwb3N0VG9VbnBpbi5pZCxcbiAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgXCJQaW5uZWQgUGxhY2VtZW50XCI6IHtcbiAgICAgICAgICAgICAgICBtdWx0aV9zZWxlY3Q6IFtdLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvLyBVcGRhdGUgbG9jYWwgcG9zdCB0byByZWZsZWN0IHVucGlubmVkIHN0YXRlXG4gICAgICAgICAgY29uc3QgcG9zdEluZGV4ID0gcG9zdHMuZmluZEluZGV4KChwKSA9PiBwLmlkID09PSBwb3N0VG9VbnBpbi5pZCk7XG4gICAgICAgICAgaWYgKHBvc3RJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIHBvc3RzW3Bvc3RJbmRleF0ucGlubmVkID0gZmFsc2U7XG4gICAgICAgICAgICBwb3N0c1twb3N0SW5kZXhdLnBpbm5lZFBsYWNlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gY2xlYXIgUGlubmVkIFBsYWNlbWVudCBmb3IgcG9zdCAke3Bvc3RUb1VucGluLmlkfTpgLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTb3J0OiBwaW5uZWQgcG9zdHMgZmlyc3QgYnkgUGlubmVkIFBsYWNlbWVudCAoMSwgMiwgMyksIHRoZW4gdW5waW5uZWQgcG9zdHMgYnkgRGF0ZVxuICAgIHBvc3RzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIGNvbnN0IGFQaW5uZWRQbGFjZW1lbnQgPSBhLnBpbm5lZFBsYWNlbWVudDtcbiAgICAgIGNvbnN0IGJQaW5uZWRQbGFjZW1lbnQgPSBiLnBpbm5lZFBsYWNlbWVudDtcbiAgICAgIGNvbnN0IGFJc1Bpbm5lZCA9IGEucGlubmVkIHx8IChhUGlubmVkUGxhY2VtZW50ICE9PSB1bmRlZmluZWQgJiYgYVBpbm5lZFBsYWNlbWVudCA+PSAxICYmIGFQaW5uZWRQbGFjZW1lbnQgPD0gMyk7XG4gICAgICBjb25zdCBiSXNQaW5uZWQgPSBiLnBpbm5lZCB8fCAoYlBpbm5lZFBsYWNlbWVudCAhPT0gdW5kZWZpbmVkICYmIGJQaW5uZWRQbGFjZW1lbnQgPj0gMSAmJiBiUGlubmVkUGxhY2VtZW50IDw9IDMpO1xuICAgICAgXG4gICAgICAvLyBQaW5uZWQgcG9zdHMgY29tZSBmaXJzdFxuICAgICAgaWYgKGFJc1Bpbm5lZCAmJiAhYklzUGlubmVkKSByZXR1cm4gLTE7XG4gICAgICBpZiAoIWFJc1Bpbm5lZCAmJiBiSXNQaW5uZWQpIHJldHVybiAxO1xuICAgICAgXG4gICAgICAvLyBJZiBib3RoIGFyZSBwaW5uZWQsIHNvcnQgYnkgUGlubmVkIFBsYWNlbWVudCAoMSwgMiwgMylcbiAgICAgIGlmIChhSXNQaW5uZWQgJiYgYklzUGlubmVkKSB7XG4gICAgICAgIGNvbnN0IGFQbGFjZW1lbnQgPSBhUGlubmVkUGxhY2VtZW50IHx8IDk5OTtcbiAgICAgICAgY29uc3QgYlBsYWNlbWVudCA9IGJQaW5uZWRQbGFjZW1lbnQgfHwgOTk5O1xuICAgICAgICByZXR1cm4gYVBsYWNlbWVudCAtIGJQbGFjZW1lbnQ7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIElmIGJvdGggYXJlIHVucGlubmVkLCBzb3J0IGJ5IERhdGUgKG1vc3QgcmVjZW50IGZpcnN0KVxuICAgICAgaWYgKGEuZGF0ZSAmJiBiLmRhdGUpIHtcbiAgICAgICAgY29uc3QgZGF0ZUEgPSBuZXcgRGF0ZShhLmRhdGUpLmdldFRpbWUoKTtcbiAgICAgICAgY29uc3QgZGF0ZUIgPSBuZXcgRGF0ZShiLmRhdGUpLmdldFRpbWUoKTtcbiAgICAgICAgcmV0dXJuIGRhdGVCIC0gZGF0ZUE7IC8vIERlc2NlbmRpbmcgKG1vc3QgcmVjZW50IGZpcnN0KVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBJZiBvbmx5IG9uZSBoYXMgYSBkYXRlLCBwcmlvcml0aXplIGl0XG4gICAgICBpZiAoYS5kYXRlICYmICFiLmRhdGUpIHJldHVybiAtMTtcbiAgICAgIGlmICghYS5kYXRlICYmIGIuZGF0ZSkgcmV0dXJuIDE7XG4gICAgICBcbiAgICAgIC8vIEZhbGxiYWNrIHRvIG9yZGVyXG4gICAgICByZXR1cm4gYS5vcmRlciAtIGIub3JkZXI7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocG9zdHMsIHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDYWNoZS1Db250cm9sXCI6IFwibm8tc3RvcmUsIG5vLWNhY2hlLCBtdXN0LXJldmFsaWRhdGUsIHByb3h5LXJldmFsaWRhdGVcIixcbiAgICAgICAgXCJQcmFnbWFcIjogXCJuby1jYWNoZVwiLFxuICAgICAgICBcIkV4cGlyZXNcIjogXCIwXCIsXG4gICAgICB9LFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBwb3N0czpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6IFwiRmFpbGVkIHRvIGZldGNoIHBvc3RzIGZyb20gTm90aW9uXCIgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXREYiIsImRlY3J5cHQiLCJDbGllbnQiLCJkeW5hbWljIiwicmV2YWxpZGF0ZSIsImdldFByb3BlcnR5VmFsdWUiLCJwYWdlIiwicHJvcGVydHlOYW1lIiwicHJvcGVydHkiLCJwcm9wZXJ0aWVzIiwidHlwZSIsInRpdGxlIiwibWFwIiwidCIsInBsYWluX3RleHQiLCJqb2luIiwicmljaF90ZXh0Iiwic2VsZWN0IiwibmFtZSIsIm11bHRpX3NlbGVjdCIsIm9wdGlvbiIsInN0YXR1cyIsIm51bWJlciIsImNoZWNrYm94IiwiZGF0ZSIsInN0YXJ0IiwidXJscyIsImZpbGUiLCJmaWxlcyIsInB1c2giLCJ1cmwiLCJleHRlcm5hbCIsIkdFVCIsInJlcXVlc3QiLCJwYXJhbXMiLCJkYiIsIndpZGdldCIsImNvbGxlY3Rpb24iLCJmaW5kT25lIiwid2lkZ2V0SWQiLCJpZCIsImpzb24iLCJlcnJvciIsIm5vdGlvblRva2VuIiwibm90aW9uIiwiYXV0aCIsInJlc3BvbnNlIiwiZGF0YWJhc2VzIiwicXVlcnkiLCJkYXRhYmFzZV9pZCIsImRhdGFiYXNlSWQiLCJzb3J0cyIsImRpcmVjdGlvbiIsImRhdGVFcnJvciIsImNvZGUiLCJib2R5IiwiaW5jbHVkZXMiLCJwb3N0cyIsInJlc3VsdHMiLCJmaWx0ZXIiLCJpbmRleCIsImltYWdlcyIsInByb3BlcnR5S2V5cyIsIk9iamVjdCIsImtleXMiLCJzdGF0dXNDb2xvciIsInN0YXR1c0tleSIsImZpbmQiLCJrZXkiLCJ0b0xvd2VyQ2FzZSIsInN0YXR1c1Byb3BlcnR5IiwiY29sb3IiLCJjYXB0aW9uIiwib3JkZXIiLCJwaW5uZWRQbGFjZW1lbnQiLCJwaW5uZWRQbGFjZW1lbnRWYWx1ZSIsInZhbCIsImlzUGlubmVkIiwicGlubmVkT3JkZXIiLCJwYXJzZUludCIsInBsYXRmb3JtUmF3IiwicGxhdGZvcm1LZXkiLCJwbGF0Zm9ybVByb3BlcnR5IiwicGxhdGZvcm1Mb3dlciIsInRyaW0iLCJwbGF0Zm9ybSIsInNvdXJjZSIsInNvdXJjZUtleSIsInNvdXJjZVByb3BlcnR5Iiwic291cmNlVmFsdWUiLCJ1bmRlZmluZWQiLCJwaW5uZWQiLCJwaW5uZWRQb3N0c0xpc3QiLCJwIiwicGxhY2VtZW50Q291bnRzIiwiZm9yRWFjaCIsImxlbmd0aCIsInZhbHVlcyIsInNvbWUiLCJjb3VudCIsImNvbnNvbGUiLCJ3YXJuIiwic29ydCIsImEiLCJiIiwicGxhY2VtZW50RGlmZiIsIkRhdGUiLCJnZXRUaW1lIiwia2VwdFBsYWNlbWVudHMiLCJTZXQiLCJwb3N0c1RvVW5waW4iLCJwb3N0IiwiaGFzIiwiYWRkIiwicG9zdFRvVW5waW4iLCJwYWdlcyIsInVwZGF0ZSIsInBhZ2VfaWQiLCJwb3N0SW5kZXgiLCJmaW5kSW5kZXgiLCJhUGlubmVkUGxhY2VtZW50IiwiYlBpbm5lZFBsYWNlbWVudCIsImFJc1Bpbm5lZCIsImJJc1Bpbm5lZCIsImFQbGFjZW1lbnQiLCJiUGxhY2VtZW50IiwiZGF0ZUEiLCJkYXRlQiIsImhlYWRlcnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/widgets/[id]/posts/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/encryption.ts":
/*!***************************!*\
  !*** ./lib/encryption.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   decrypt: () => (/* binding */ decrypt),\n/* harmony export */   encrypt: () => (/* binding */ encrypt)\n/* harmony export */ });\n/* harmony import */ var crypto_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto-js */ \"(rsc)/./node_modules/crypto-js/index.js\");\n/* harmony import */ var crypto_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto_js__WEBPACK_IMPORTED_MODULE_0__);\n\nconst SECRET_KEY = process.env.ENCRYPTION_KEY || process.env.NEXTAUTH_SECRET || \"fallback-key\";\nfunction encrypt(text) {\n    return crypto_js__WEBPACK_IMPORTED_MODULE_0___default().AES.encrypt(text, SECRET_KEY).toString();\n}\nfunction decrypt(ciphertext) {\n    const bytes = crypto_js__WEBPACK_IMPORTED_MODULE_0___default().AES.decrypt(ciphertext, SECRET_KEY);\n    return bytes.toString((crypto_js__WEBPACK_IMPORTED_MODULE_0___default().enc).Utf8);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvZW5jcnlwdGlvbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQWlDO0FBRWpDLE1BQU1DLGFBQWFDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYyxJQUFJRixRQUFRQyxHQUFHLENBQUNFLGVBQWUsSUFBSTtBQUV6RSxTQUFTQyxRQUFRQyxJQUFZO0lBQ2xDLE9BQU9QLG9EQUFZLENBQUNNLE9BQU8sQ0FBQ0MsTUFBTU4sWUFBWVEsUUFBUTtBQUN4RDtBQUVPLFNBQVNDLFFBQVFDLFVBQWtCO0lBQ3hDLE1BQU1DLFFBQVFaLG9EQUFZLENBQUNVLE9BQU8sQ0FBQ0MsWUFBWVY7SUFDL0MsT0FBT1csTUFBTUgsUUFBUSxDQUFDVCxzREFBWSxDQUFDYyxJQUFJO0FBQ3pDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaW5zdGEtZ3JpZC8uL2xpYi9lbmNyeXB0aW9uLnRzPzMzNzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENyeXB0b0pTIGZyb20gXCJjcnlwdG8tanNcIjtcblxuY29uc3QgU0VDUkVUX0tFWSA9IHByb2Nlc3MuZW52LkVOQ1JZUFRJT05fS0VZIHx8IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1NFQ1JFVCB8fCBcImZhbGxiYWNrLWtleVwiO1xuXG5leHBvcnQgZnVuY3Rpb24gZW5jcnlwdCh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gQ3J5cHRvSlMuQUVTLmVuY3J5cHQodGV4dCwgU0VDUkVUX0tFWSkudG9TdHJpbmcoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlY3J5cHQoY2lwaGVydGV4dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgYnl0ZXMgPSBDcnlwdG9KUy5BRVMuZGVjcnlwdChjaXBoZXJ0ZXh0LCBTRUNSRVRfS0VZKTtcbiAgcmV0dXJuIGJ5dGVzLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5VdGY4KTtcbn1cbiJdLCJuYW1lcyI6WyJDcnlwdG9KUyIsIlNFQ1JFVF9LRVkiLCJwcm9jZXNzIiwiZW52IiwiRU5DUllQVElPTl9LRVkiLCJORVhUQVVUSF9TRUNSRVQiLCJlbmNyeXB0IiwidGV4dCIsIkFFUyIsInRvU3RyaW5nIiwiZGVjcnlwdCIsImNpcGhlcnRleHQiLCJieXRlcyIsImVuYyIsIlV0ZjgiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/encryption.ts\n");

/***/ }),

/***/ "(rsc)/./lib/mongodb.ts":
/*!************************!*\
  !*** ./lib/mongodb.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   getDb: () => (/* binding */ getDb)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst options = {\n    serverApi: {\n        version: mongodb__WEBPACK_IMPORTED_MODULE_0__.ServerApiVersion.v1,\n        strict: true,\n        deprecationErrors: true\n    }\n};\nlet client = null;\nlet clientPromise = null;\n/** Build MongoDB URI from env. Supports full MONGODB_URI or separate user/password/cluster (password is URL-encoded for you). */ function getMongoUri() {\n    const fullUri = process.env.MONGODB_URI;\n    if (fullUri && fullUri.trim()) {\n        console.log(\"[MongoDB] Using MONGODB_URI (full connection string)\");\n        // Extract username and cluster from URI for logging (without password)\n        try {\n            const match = fullUri.match(/mongodb\\+srv:\\/\\/([^:]+):([^@]+)@([^/]+)/);\n            if (match) {\n                console.log(\"[MongoDB] Username:\", match[1]);\n                console.log(\"[MongoDB] Cluster:\", match[3]);\n            }\n        } catch (e) {\n        // Ignore parsing errors\n        }\n        return fullUri.trim();\n    }\n    const user = process.env.MONGODB_USER;\n    const password = process.env.MONGODB_PASSWORD;\n    const cluster = process.env.MONGODB_CLUSTER; // e.g. pedocluster.vyjvmsk.mongodb.net\n    const dbName = process.env.MONGODB_DB_NAME || \"instagram_grid_planner\";\n    if (user && password && cluster) {\n        console.log(\"[MongoDB] Using separate env vars (MONGODB_USER/PASSWORD/CLUSTER)\");\n        console.log(\"[MongoDB] Username:\", user);\n        console.log(\"[MongoDB] Cluster:\", cluster);\n        const encodedUser = encodeURIComponent(user);\n        const encodedPassword = encodeURIComponent(password);\n        return `mongodb+srv://${encodedUser}:${encodedPassword}@${cluster}/${dbName}?retryWrites=true&w=majority`;\n    }\n    return \"\";\n}\nfunction getClientPromise() {\n    const uri = getMongoUri();\n    console.log(\"[MongoDB] getClientPromise called\");\n    console.log(\"[MongoDB] NODE_ENV:\", \"development\");\n    console.log(\"[MongoDB] URI exists:\", !!uri);\n    console.log(\"[MongoDB] URI starts with:\", uri ? uri.substring(0, 25) + \"...\" : \"N/A\");\n    if (!uri) {\n        console.error(\"[MongoDB] ERROR: Set MONGODB_URI, or MONGODB_USER + MONGODB_PASSWORD + MONGODB_CLUSTER in .env.local\");\n        throw new Error(\"Please add your MongoDB URI (or user/password/cluster) to .env.local\");\n    }\n    if (true) {\n        // In development, use a global variable to preserve the connection across HMR\n        if (!global._mongoClientPromise) {\n            console.log(\"[MongoDB] Creating new client (development)\");\n            client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, options);\n            global._mongoClientPromise = client.connect().then((client)=>{\n                console.log(\"[MongoDB] Connected successfully (development)\");\n                return client;\n            }).catch((error)=>{\n                console.error(\"[MongoDB] Connection error (development):\", error);\n                throw error;\n            });\n        }\n        return global._mongoClientPromise;\n    } else {}\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (getClientPromise);\nasync function getDb() {\n    console.log(\"[MongoDB] getDb called\");\n    try {\n        const client = await getClientPromise();\n        const db = client.db(\"instagram_grid_planner\");\n        console.log(\"[MongoDB] Database 'instagram_grid_planner' accessed\");\n        return db;\n    } catch (error) {\n        console.error(\"[MongoDB] getDb error:\", error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ1osT0FBTzRCO0lBQ1QsRUFBRSxPQUFPWCxPQUFPO1FBQ2RsQixRQUFRa0IsS0FBSyxDQUFDLDBCQUEwQkE7UUFDeEMsTUFBTUE7SUFDUjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaW5zdGEtZ3JpZC8uL2xpYi9tb25nb2RiLnRzPzA1YmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTW9uZ29DbGllbnQsIERiLCBTZXJ2ZXJBcGlWZXJzaW9uIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuY29uc3Qgb3B0aW9ucyA9IHtcbiAgc2VydmVyQXBpOiB7XG4gICAgdmVyc2lvbjogU2VydmVyQXBpVmVyc2lvbi52MSxcbiAgICBzdHJpY3Q6IHRydWUsXG4gICAgZGVwcmVjYXRpb25FcnJvcnM6IHRydWUsXG4gIH0sXG59O1xuXG5sZXQgY2xpZW50OiBNb25nb0NsaWVudCB8IG51bGwgPSBudWxsO1xubGV0IGNsaWVudFByb21pc2U6IFByb21pc2U8TW9uZ29DbGllbnQ+IHwgbnVsbCA9IG51bGw7XG5cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgdmFyIF9tb25nb0NsaWVudFByb21pc2U6IFByb21pc2U8TW9uZ29DbGllbnQ+IHwgdW5kZWZpbmVkO1xufVxuXG4vKiogQnVpbGQgTW9uZ29EQiBVUkkgZnJvbSBlbnYuIFN1cHBvcnRzIGZ1bGwgTU9OR09EQl9VUkkgb3Igc2VwYXJhdGUgdXNlci9wYXNzd29yZC9jbHVzdGVyIChwYXNzd29yZCBpcyBVUkwtZW5jb2RlZCBmb3IgeW91KS4gKi9cbmZ1bmN0aW9uIGdldE1vbmdvVXJpKCk6IHN0cmluZyB7XG4gIGNvbnN0IGZ1bGxVcmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcbiAgaWYgKGZ1bGxVcmkgJiYgZnVsbFVyaS50cmltKCkpIHtcbiAgICBjb25zb2xlLmxvZyhcIltNb25nb0RCXSBVc2luZyBNT05HT0RCX1VSSSAoZnVsbCBjb25uZWN0aW9uIHN0cmluZylcIik7XG4gICAgLy8gRXh0cmFjdCB1c2VybmFtZSBhbmQgY2x1c3RlciBmcm9tIFVSSSBmb3IgbG9nZ2luZyAod2l0aG91dCBwYXNzd29yZClcbiAgICB0cnkge1xuICAgICAgY29uc3QgbWF0Y2ggPSBmdWxsVXJpLm1hdGNoKC9tb25nb2RiXFwrc3J2OlxcL1xcLyhbXjpdKyk6KFteQF0rKUAoW14vXSspLyk7XG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJbTW9uZ29EQl0gVXNlcm5hbWU6XCIsIG1hdGNoWzFdKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJbTW9uZ29EQl0gQ2x1c3RlcjpcIiwgbWF0Y2hbM10pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIElnbm9yZSBwYXJzaW5nIGVycm9yc1xuICAgIH1cbiAgICByZXR1cm4gZnVsbFVyaS50cmltKCk7XG4gIH1cbiAgY29uc3QgdXNlciA9IHByb2Nlc3MuZW52Lk1PTkdPREJfVVNFUjtcbiAgY29uc3QgcGFzc3dvcmQgPSBwcm9jZXNzLmVudi5NT05HT0RCX1BBU1NXT1JEO1xuICBjb25zdCBjbHVzdGVyID0gcHJvY2Vzcy5lbnYuTU9OR09EQl9DTFVTVEVSOyAvLyBlLmcuIHBlZG9jbHVzdGVyLnZ5anZtc2subW9uZ29kYi5uZXRcbiAgY29uc3QgZGJOYW1lID0gcHJvY2Vzcy5lbnYuTU9OR09EQl9EQl9OQU1FIHx8IFwiaW5zdGFncmFtX2dyaWRfcGxhbm5lclwiO1xuICBpZiAodXNlciAmJiBwYXNzd29yZCAmJiBjbHVzdGVyKSB7XG4gICAgY29uc29sZS5sb2coXCJbTW9uZ29EQl0gVXNpbmcgc2VwYXJhdGUgZW52IHZhcnMgKE1PTkdPREJfVVNFUi9QQVNTV09SRC9DTFVTVEVSKVwiKTtcbiAgICBjb25zb2xlLmxvZyhcIltNb25nb0RCXSBVc2VybmFtZTpcIiwgdXNlcik7XG4gICAgY29uc29sZS5sb2coXCJbTW9uZ29EQl0gQ2x1c3RlcjpcIiwgY2x1c3Rlcik7XG4gICAgY29uc3QgZW5jb2RlZFVzZXIgPSBlbmNvZGVVUklDb21wb25lbnQodXNlcik7XG4gICAgY29uc3QgZW5jb2RlZFBhc3N3b3JkID0gZW5jb2RlVVJJQ29tcG9uZW50KHBhc3N3b3JkKTtcbiAgICByZXR1cm4gYG1vbmdvZGIrc3J2Oi8vJHtlbmNvZGVkVXNlcn06JHtlbmNvZGVkUGFzc3dvcmR9QCR7Y2x1c3Rlcn0vJHtkYk5hbWV9P3JldHJ5V3JpdGVzPXRydWUmdz1tYWpvcml0eWA7XG4gIH1cbiAgcmV0dXJuIFwiXCI7XG59XG5cbmZ1bmN0aW9uIGdldENsaWVudFByb21pc2UoKTogUHJvbWlzZTxNb25nb0NsaWVudD4ge1xuICBjb25zdCB1cmkgPSBnZXRNb25nb1VyaSgpO1xuICBjb25zb2xlLmxvZyhcIltNb25nb0RCXSBnZXRDbGllbnRQcm9taXNlIGNhbGxlZFwiKTtcbiAgY29uc29sZS5sb2coXCJbTW9uZ29EQl0gTk9ERV9FTlY6XCIsIHByb2Nlc3MuZW52Lk5PREVfRU5WKTtcbiAgY29uc29sZS5sb2coXCJbTW9uZ29EQl0gVVJJIGV4aXN0czpcIiwgISF1cmkpO1xuICBjb25zb2xlLmxvZyhcIltNb25nb0RCXSBVUkkgc3RhcnRzIHdpdGg6XCIsIHVyaSA/IHVyaS5zdWJzdHJpbmcoMCwgMjUpICsgXCIuLi5cIiA6IFwiTi9BXCIpO1xuXG4gIGlmICghdXJpKSB7XG4gICAgY29uc29sZS5lcnJvcihcIltNb25nb0RCXSBFUlJPUjogU2V0IE1PTkdPREJfVVJJLCBvciBNT05HT0RCX1VTRVIgKyBNT05HT0RCX1BBU1NXT1JEICsgTU9OR09EQl9DTFVTVEVSIGluIC5lbnYubG9jYWxcIik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiUGxlYXNlIGFkZCB5b3VyIE1vbmdvREIgVVJJIChvciB1c2VyL3Bhc3N3b3JkL2NsdXN0ZXIpIHRvIC5lbnYubG9jYWxcIik7XG4gIH1cblxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwiZGV2ZWxvcG1lbnRcIikge1xuICAgIC8vIEluIGRldmVsb3BtZW50LCB1c2UgYSBnbG9iYWwgdmFyaWFibGUgdG8gcHJlc2VydmUgdGhlIGNvbm5lY3Rpb24gYWNyb3NzIEhNUlxuICAgIGlmICghZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiW01vbmdvREJdIENyZWF0aW5nIG5ldyBjbGllbnQgKGRldmVsb3BtZW50KVwiKTtcbiAgICAgIGNsaWVudCA9IG5ldyBNb25nb0NsaWVudCh1cmksIG9wdGlvbnMpO1xuICAgICAgZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UgPSBjbGllbnQuY29ubmVjdCgpLnRoZW4oKGNsaWVudCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIltNb25nb0RCXSBDb25uZWN0ZWQgc3VjY2Vzc2Z1bGx5IChkZXZlbG9wbWVudClcIik7XG4gICAgICAgIHJldHVybiBjbGllbnQ7XG4gICAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIltNb25nb0RCXSBDb25uZWN0aW9uIGVycm9yIChkZXZlbG9wbWVudCk6XCIsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGdsb2JhbC5fbW9uZ29DbGllbnRQcm9taXNlO1xuICB9IGVsc2Uge1xuICAgIC8vIEluIHByb2R1Y3Rpb24sIGNyZWF0ZSBhIG5ldyBjbGllbnQgZm9yIGVhY2ggcmVxdWVzdFxuICAgIGlmICghY2xpZW50UHJvbWlzZSkge1xuICAgICAgY29uc29sZS5sb2coXCJbTW9uZ29EQl0gQ3JlYXRpbmcgbmV3IGNsaWVudCAocHJvZHVjdGlvbilcIik7XG4gICAgICBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpLCBvcHRpb25zKTtcbiAgICAgIGNsaWVudFByb21pc2UgPSBjbGllbnQuY29ubmVjdCgpLnRoZW4oKGNsaWVudCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIltNb25nb0RCXSBDb25uZWN0ZWQgc3VjY2Vzc2Z1bGx5IChwcm9kdWN0aW9uKVwiKTtcbiAgICAgICAgcmV0dXJuIGNsaWVudDtcbiAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiW01vbmdvREJdIENvbm5lY3Rpb24gZXJyb3IgKHByb2R1Y3Rpb24pOlwiLCBlcnJvcik7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbTW9uZ29EQl0gRXJyb3IgZGV0YWlsczpcIiwge1xuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgbmFtZTogZXJyb3IubmFtZSxcbiAgICAgICAgICBzdGFjazogZXJyb3Iuc3RhY2ssXG4gICAgICAgIH0pO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gY2xpZW50UHJvbWlzZTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBnZXRDbGllbnRQcm9taXNlO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0RGIoKTogUHJvbWlzZTxEYj4ge1xuICBjb25zb2xlLmxvZyhcIltNb25nb0RCXSBnZXREYiBjYWxsZWRcIik7XG4gIHRyeSB7XG4gICAgY29uc3QgY2xpZW50ID0gYXdhaXQgZ2V0Q2xpZW50UHJvbWlzZSgpO1xuICAgIGNvbnN0IGRiID0gY2xpZW50LmRiKFwiaW5zdGFncmFtX2dyaWRfcGxhbm5lclwiKTtcbiAgICBjb25zb2xlLmxvZyhcIltNb25nb0RCXSBEYXRhYmFzZSAnaW5zdGFncmFtX2dyaWRfcGxhbm5lcicgYWNjZXNzZWRcIik7XG4gICAgcmV0dXJuIGRiO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJbTW9uZ29EQl0gZ2V0RGIgZXJyb3I6XCIsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk1vbmdvQ2xpZW50IiwiU2VydmVyQXBpVmVyc2lvbiIsIm9wdGlvbnMiLCJzZXJ2ZXJBcGkiLCJ2ZXJzaW9uIiwidjEiLCJzdHJpY3QiLCJkZXByZWNhdGlvbkVycm9ycyIsImNsaWVudCIsImNsaWVudFByb21pc2UiLCJnZXRNb25nb1VyaSIsImZ1bGxVcmkiLCJwcm9jZXNzIiwiZW52IiwiTU9OR09EQl9VUkkiLCJ0cmltIiwiY29uc29sZSIsImxvZyIsIm1hdGNoIiwiZSIsInVzZXIiLCJNT05HT0RCX1VTRVIiLCJwYXNzd29yZCIsIk1PTkdPREJfUEFTU1dPUkQiLCJjbHVzdGVyIiwiTU9OR09EQl9DTFVTVEVSIiwiZGJOYW1lIiwiTU9OR09EQl9EQl9OQU1FIiwiZW5jb2RlZFVzZXIiLCJlbmNvZGVVUklDb21wb25lbnQiLCJlbmNvZGVkUGFzc3dvcmQiLCJnZXRDbGllbnRQcm9taXNlIiwidXJpIiwic3Vic3RyaW5nIiwiZXJyb3IiLCJFcnJvciIsImdsb2JhbCIsIl9tb25nb0NsaWVudFByb21pc2UiLCJjb25uZWN0IiwidGhlbiIsImNhdGNoIiwibWVzc2FnZSIsIm5hbWUiLCJzdGFjayIsImdldERiIiwiZGIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/mongodb.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/tr46","vendor-chunks/crypto-js","vendor-chunks/@notionhq","vendor-chunks/node-fetch","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fwidgets%2F%5Bid%5D%2Fposts%2Froute&page=%2Fapi%2Fwidgets%2F%5Bid%5D%2Fposts%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwidgets%2F%5Bid%5D%2Fposts%2Froute.ts&appDir=%2FUsers%2Fcookiemonster%2FDocuments%2FReact-app%2FCuddles-CMS%2FInsta_grid%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcookiemonster%2FDocuments%2FReact-app%2FCuddles-CMS%2FInsta_grid&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();